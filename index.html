<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Visualize your most-used programming languages in your Github repos with Langits.</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Visualize your most-used programming languages in your Github repos with Langits." />
</head>
<body>
  <h1>Langits</h1>
  <p>Visualize your most-used programming languages in your GitHub repos.</p>
  <form id="form" action="" onsubmit="">
    <label>
      Enter your Github username:
      <input type="text" placeholder="username"/>
    </label>
    <button type="submit">Submit</button>
  </form>
  <div id="langits"></div>
  <script type="text/javascript">
    const form = document.getElementById("form");
    const langits = document.getElementById("langits");
    
    form.addEventListener("submit", function(e) {
      e.preventDefault();
      getData(e.target[0].value);
    });
    
    async function getData(username) {

      fetch("/api/getLanguages", {
        method: "POST",
        body: JSON.stringify({
          username: username
        })
      })
      .then((response) => {
        // console.log(response.status)
        if (response.status >= 200 && response.status <= 299) {
          return response.json();
        } else {
          throw Error(response.statusText);
        }
      })
      .then((jsonResponse) => {
        // console.log(JSON.stringify(jsonResponse, null, 2));
        putDataInTable(jsonResponse)
      }).catch((error) => {
        // Handle the error
        alert('Something went wrong. Try a different username.')
      });
    }

    function putDataInTable(data) {
      langits.innerHTML = "";

      if(data.langs.length === 0) {
        langits.innerHTML = "<p>The user has no repos with languages.</p>"
        return false;
      }
      const table = document.createElement('table');
      table.setAttribute('style', 'border-collapse: collapse; margin-top: 20px;');
      const tbody = document.createElement('tbody');

      data.langs.forEach(lang => {
        const tr = document.createElement('tr');
        
          const td_color = document.createElement('td');
          td_color.setAttribute('style', 'background: '+lang.color+"; width: 30px;");
          tr.appendChild(td_color);

          const td_name = document.createElement('td');
          td_name.appendChild(document.createTextNode(lang.name));
          td_name.setAttribute('style', 'border: 1px solid black; padding: 4px 6px;');
          tr.appendChild(td_name);

          const td_percent = document.createElement('td');
          td_percent.appendChild(document.createTextNode(lang.percent + "%"));
          td_percent.setAttribute('style', 'border: 1px solid black; padding: 4px 6px;');
          tr.appendChild(td_percent);

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      langits.appendChild(table);
    }
  </script>
</body>
</html>